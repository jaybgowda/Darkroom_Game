<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Darkroom Simulation</title>
<style>
body { margin:0; background:#000; overflow:hidden; font-family:Arial; color:white; }
canvas { display:block; margin:0 auto; background:#111; }
#lives, #score, #shield { position:absolute; top:10px; font-size:20px; padding:5px; }
#lives { left:10px; }
#score { right:10px; }
#shield { top:40px; left:10px; }
#questionBox, #titleScreen, #controlsScreen {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#222; padding:20px; border-radius:10px; display:none; width:60%; text-align:center;
}
.choice { background:#333; padding:10px; margin:10px 0; border-radius:8px; cursor:pointer; }
.choice:hover { background:#444; }
button { padding:10px 20px; font-size:18px; margin-top:10px; cursor:pointer; }
#phoneOverlay {
  position:absolute; bottom:10px; right:10px; width:120px; height:200px;
  background-size:cover;
}
</style>
</head>
<body>

<canvas id="gameCanvas" width="900" height="900"></canvas>

<div id="lives">Lives: 3</div>
<div id="score">Score: 0</div>
<div id="shield">Shield: 0</div>

<div id="titleScreen">
  <h1>October/November Book Project</h1>
  <h2>Darkroom Simulation</h2>
  <p>Created by: Jay Gowda</p>
  <button onclick="showControls()">Start</button>
</div>

<div id="controlsScreen">
  <h2>Controls & Mechanics</h2>
  <p>Arrow keys → Move player</p>
  <p>Collide with ghosts → Answer a question</p>
  <p>3 correct answers in a row → Earn a shield</p>
  <button onclick="startGame()">Play Game</button>
</div>

<div id="questionBox">
  <div id="qText"></div>
  <div id="choices"></div>
</div>

<div id="phoneOverlay"></div>

<script>
// ===== Base64 Images =====
let ghostImg = new Image();
ghostImg.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAK0lEQVR42u3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAgG8GFgABHMXdUAAAAABJRU5ErkJggg=="; // red circle placeholder
let phoneImg = new Image();
phoneImg.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHwAAABACAYAAAC+qZ3LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAH0lEQVR42u3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAwNY4HwAAH3GG3UAAAAASUVORK5CYII="; // phone placeholder
document.getElementById("phoneOverlay").style.backgroundImage = "url('"+phoneImg.src+"')";

// ===== Audio =====
let jumpScare = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

// ===== Game variables =====
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let player = {x:450, y:450, size:25, speed:5};
let ghosts = [];
let lives = 3, score = 0, streak = 0, shields = 0;
let quizActive = false;

// ===== Questions =====
const questions=[
  {q:"What is the main object in Darkroom?",c:["Camera","Flashlight","Phone","Notebook"],a:0},
  {q:"Why does the main character go into the darkroom?",c:["Hide","Take Photos","Investigate","Find a Friend"],a:2},
  {q:"What emotion dominates the story?",c:["Happiness","Fear","Anger","Excitement"],a:1},
  {q:"What is unusual about the photos?",c:["They show ghosts","They turn white","They burn","They disappear"],a:0},
  {q:"Where does the main event occur?",c:["Hallway","Basement","Outside","Darkroom"],a:3}
];

// ===== Spawn Ghosts =====
function spawnGhosts() {
  ghosts = [];
  for(let i=0;i<5;i++){
    ghosts.push({x:Math.random()*850, y:Math.random()*850, dx:(Math.random()*2-1)*2, dy:(Math.random()*2-1)*2, size:50});
  }
}

// ===== Controls =====
let keys = {};
document.addEventListener("keydown", e => { keys[e.key] = true; });
document.addEventListener("keyup", e => { keys[e.key] = false; });

function movePlayer() {
  if(quizActive) return;
  if(keys["ArrowUp"]) player.y -= player.speed;
  if(keys["ArrowDown"]) player.y += player.speed;
  if(keys["ArrowLeft"]) player.x -= player.speed;
  if(keys["ArrowRight"]) player.x += player.speed;
  player.x = Math.max(0, Math.min(canvas.width-player.size, player.x));
  player.y = Math.max(0, Math.min(canvas.height-player.size, player.y));
}

// ===== Ghost Animation =====
function animateGhosts(){
  ghosts.forEach(g=>{
    g.x += g.dx; g.y += g.dy;
    if(g.x<0 || g.x>canvas.width-g.size) g.dx*=-1;
    if(g.y<0 || g.y>canvas.height-g.size) g.dy*=-1;
  });
}

// ===== Collision & Question =====
function checkCollision(){
  if(quizActive) return;
  ghosts.forEach(g=>{
    let dx = player.x - g.x;
    let dy = player.y - g.y;
    if(Math.sqrt(dx*dx + dy*dy) < player.size+g.size/2){
      jumpScare.play();
      showQuestion();
    }
  });
}

function showQuestion(){
  quizActive = true;
  let q = questions[Math.floor(Math.random()*questions.length)];
  document.getElementById("qText").innerText = q.q;
  let cBox = document.getElementById("choices");
  cBox.innerHTML = "";
  q.c.forEach((choice,i)=>{
    let div = document.createElement("div");
    div.className = "choice";
    div.innerText = choice;
    div.onclick = ()=> handleAnswer(i===q.a);
    cBox.appendChild(div);
  });
  document.getElementById("questionBox").style.display="block";
}

function handleAnswer(correct){
  if(correct){
    score++; streak++;
    if(streak%3===0){ shields++; alert("Shield earned!"); }
  } else {
    if(shields>0){ shields--; alert("Shield protected you!"); } 
    else { lives--; if(lives<=0){alert("GAME OVER! Score: "+score); location.reload();} }
    streak=0;
  }
  document.getElementById("score").innerText="Score: "+score;
  document.getElementById("lives").innerText="Lives: "+lives;
  document.getElementById("shield").innerText="Shield: "+shields;
  document.getElementById("questionBox").style.display="none"; quizActive=false;
}

// ===== Draw =====
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="cyan"; ctx.fillRect(player.x,player.y,player.size,player.size);
  ghosts.forEach(g=>{
    ctx.drawImage(ghostImg,g.x,g.y,g.size,g.size);
  });
}

// ===== Game Loop =====
function gameLoop(){
  movePlayer();
  animateGhosts();
  checkCollision();
  draw();
  requestAnimationFrame(gameLoop);
}

// ===== Start / Controls =====
function showControls(){
  document.getElementById("titleScreen").style.display="none";
  document.getElementById("controlsScreen").style.display="block";
}

function startGame(){
  document.getElementById("controlsScreen").style.display="none";
  spawnGhosts();
  gameLoop();
}

// ===== Show title screen initially =====
document.getElementById("titleScreen").style.display="block";
</script>
</body>
</html>
